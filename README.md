# 多模態影片分析與 RAG 檢索系統

這個專案是一個全方位的影片內容分析與檢索增強生成 (Retrieval-Augmented Generation, RAG) 系統。其主要功能是將非結構化的影片資料轉化為結構化且可搜尋的知識庫。透過整合電腦視覺 (Computer Vision) 與自然語言處理 (NLP) 技術，本系統能夠自動化地對影片進行場景偵測、物件識別、語音轉文字，並將這些資訊整合建置成一個多模態資料庫。使用者後續可透過自然語言提問，系統將檢索相關的影片片段、對話內容或關鍵畫面進行回答，適用於影片內容管理、長影片摘要與深度搜尋等應用場景。

## 專案結構與模組說明

本專案依據處理流程分為以下幾個主要模組，請依照順序執行以完成資料處理管線：

### 1. 關鍵影格與物件偵測 (1_關鍵偵擷取)
此模組負責影片的視覺分析。
*   **功能**：使用 TransNetV2 進行精確的場景分割 (Scene Detection)，並結合 YOLOv8 模型進行畫面中的物件偵測。
*   **產出**：影片的關鍵影格 (Keyframes) 及包含物件資訊的分析報告。
*   **主要程式**：`analyze.py`

### 2. 語音逐字稿擷取 (2_逐字稿擷取)
此模組負責影片的聽覺內容分析。
*   **功能**：利用 OpenAI Whisper 模型進行語音辨識 (ASR)，將影片中的對話與旁白轉為文字。
*   **產出**：包含時間戳記的逐字稿 (CSV 格式)。
*   **主要程式**：`transcribe.py`

### 3. 圖文對齊與截圖 (3_逐字稿圖片擷取)
此模組負責將視覺與文字資訊進行對齊。
*   **功能**：根據逐字稿的時間戳記，回頭對影片進行精確截圖，確保每一段對話都有對應的視覺畫面，建立多模態資料的關聯。
*   **產出**：與對話內容對應的截圖檔案及其索引。
*   **主要程式**：`extract_screenshots.py`

### 4. RAG 資料庫建置與查詢 (5_RAG_database)
此模組是系統的核心應用層。
*   **功能**：
    *   **資料獲取 (Ingestion)**：將上述步驟產生的文字逐字稿與影像資料進行向量化 (Embedding)，並存入向量資料庫 (`rag_mm.db`, `image.index`, `text.index`)。
    *   **查詢 (Query)**：提供檢索介面，讓使用者輸入問題，系統會同時搜尋相關的文字與圖片內容來生成回應。
*   **主要程式**：
    *   `rag_ingest.py`: 建立資料庫。
    *   `rag_query.py`: 執行查詢。
    *   `server.py`: 啟動網頁介面伺服器。

## 使用方式簡述

建議依照目錄編號順序 (1 -> 2 -> 3 -> 5) 執行各階段的 Python 腳本，以確保資料流的完整性。最終在 `5_RAG_database` 中啟動查詢服務即可開始使用。
